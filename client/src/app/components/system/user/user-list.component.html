<app-breadcrumb></app-breadcrumb>
<div class="menu-master">
	<h2 class="s-title">ユーザー</h2>
	<form autocomplete="off">
		<!-- SECTION FILTER -->
		<section class="g-filter clearfix">
			<div class="g-row clearfix">
	            <div class="field clearfix w50">
	                <label for="">会社名</label>
	                <div class="input-select2">
	                    <ng-select
	                        [items]="companyOptions"
	                        [active]="filter.m_company_id | selectobject: companyOptions"
	                        [allowClear]="true"
	                        (selected)="onSelectFilterChange($event, 'company')"
	                        (removed)="onSelectFilterChange($event, 'company', 'deselected')"
	                        (ngModel)="filter.m_company_id"
	                        placeholder="{{ 'SELECT_PLACEHOLDER' | translate }}">
	                    </ng-select>
	                </div>
	            </div>
	            <div class="field clearfix w50">
	                <label for="">事業本部</label>
	                <div class="input-select2">
	                    <ng-select
	                        [items]="businessOptions"
	                        [active]="filter.business_id | selectobject: businessOptions"
	                        [allowClear]="true"
	                        (selected)="onSelectFilterChange($event, 'business')"
	                        (removed)="onSelectFilterChange($event, 'business', 'deselected')"
	                        (ngModel)="filter.business_id"
	                        placeholder="{{ 'SELECT_PLACEHOLDER' | translate }}">
	                    </ng-select>
	                </div>
	            </div>
	            <div class="field clearfix w50">
	                <label for="">事業部</label>
	                <div class="input-select2">
	                    <ng-select
	                        [items]="divisionOptions"
	                        [active]="filter.division_id | selectobject: divisionOptions"
	                        [allowClear]="true"
	                        (selected)="onSelectFilterChange($event, 'division')"
	                        (removed)="onSelectFilterChange($event, 'division', 'deselected')"
	                        (ngModel)="filter.division_id"
	                        placeholder="{{ 'SELECT_PLACEHOLDER' | translate }}">
	                    </ng-select>
	                </div>
	            </div>
	            <div class="field clearfix w50">
	                <label for="">部門</label>
	                <div class="input-select2">
	                    <ng-select
	                        [items]="departmentOptions"
	                        [active]="filter.department_id | selectobject: departmentOptions"
	                        [allowClear]="true"
	                        (selected)="onSelectFilterChange($event, 'department')"
	                        (removed)="onSelectFilterChange($event, 'department', 'deselected')"
	                        (ngModel)="filter.department_id"
	                        placeholder="{{ 'SELECT_PLACEHOLDER' | translate }}">
	                    </ng-select>
	                </div>
	            </div>
	            <div class="field clearfix w50">
	                <label for="">社員NO</label>
	                <div class="clearfix">
                        <input type="text" name="staff_no" class="form-control" [(ngModel)]="filter.staff_no" >
	                </div>
	            </div>
	            <div class="field clearfix w50">
	                <label for="">ユーザID</label>
	                <div class="clearfix">
                        <input type="text" name="user_id" class="form-control" [(ngModel)]="filter.user_id" >
	                </div>
	            </div>
	            <div class="field clearfix w50">
	                <label for="">名前</label>
	                <div class="clearfix">
                        <input type="text" name="fullname" class="form-control" [(ngModel)]="filter.fullname" >
	                </div>
	            </div>
	            <div class="field clearfix w50">
	                <label for="">役職</label>
	                <div class="input-select2">
	                	<ng-select
	                        [items]="positionOptions"
	                        [active]="filter.m_position_id | selectobject: positionOptions"
	                        [allowClear]="true"
	                        (selected)="onNgSelected($event, 'posistion')"
	                        (removed)="onNgRemoved($event, 'posistion')"
	                        (ngModel)="filter.m_position_id"
	                        placeholder="{{ 'SELECT_PLACEHOLDER' | translate }}">
	                    </ng-select>
	                </div>
	            </div>
	            <div class="field clearfix w50">
	                <label for="">入社年月日</label>
	                <div class="clearfix">
	                    <div class="input-group">
	                        <input type="text" name="entry_date" class="form-control daterange-single"
	                            [(ngModel)]="filter.entry_date"
	                            #entry_date
	                            (blur)="filter.entry_date = entry_date.value">
	                        <span class="input-group-addon"><i class="icon-calendar"></i></span>
	                    </div>
	                </div>
	            </div>
	            <div class="field clearfix w50">
	                <label for="">退職年月日</label>
	                <div class="clearfix">
	                    <div class="input-group">
	                        <input type="text" name="retirement_date" class="form-control daterange-single"
	                            [(ngModel)]="filter.retirement_date"
	                            #retirement_date
	                            (blur)="filter.retirement_date = retirement_date.value">
	                        <span class="input-group-addon"><i class="icon-calendar"></i></span>
	                    </div>
	                </div>
	            </div>
	        </div>
		</section>
		<!-- END SECTION FILTER -->

		<!-- SECTION BUTTON -->
		<section class="g-button clearfix text-center">
			<button class="btn btn-style btn-search" type="button" (click)="onSearch()" id="btn_submit_form"><i class="fa fa-search"></i> 検索</button>
			<button class="btn btn-style btn-clear" type="button" (click)="onReset()"><i class="fa fa-eraser"></i> クリア</button>
			<a class="btn btn-style btn-back" [routerLink]="['/home']"><i class="fa fa-arrow-left"></i> 戻る</a>
		</section>
		<!-- END SECTION BUTTON -->
	</form>
	<section class="g-table-button text-right">
		<a class="btn btn-style btn-add" [routerLink]="['/system/user/create']" *ngIf="current_user_info?.permission_system || current_user_info?.permission_hr"><i class="fa fa-plus"></i>&nbsp;追加</a>
		<a class="btn btn-style btn-add" (click)="modal_export.open('sm')"><i class="fa fa-file-excel-o"></i>&nbsp;一覧出力</a>
	</section>
	<!-- SECTION TABLE -->
	<section class="g-table">
		<table id="tbl-data" class="tbl-data responsive cell-border" width="100%" cellspacing="0">
			<thead>
				<tr>
					<th class="text-center">社員No</th>
					<th class="text-center">ユーザID</th>
					<th class="text-center">社員名</th>
					<th class="text-center">役職</th>
					<th class="text-center">事業本部</th>
					<th class="text-center">事業部</th>
					<th class="text-center">部門</th>
					<th class="text-center" colspan="2" *ngIf="current_user_info?.permission_system || current_user_info?.permission_hr">処理</th>
					<th class="text-center" *ngIf="!current_user_info?.permission_system && !current_user_info?.permission_hr">処理</th>
				</tr>
			</thead>
		</table>
	</section>
	<!-- END SECTION TABLE -->
</div>

<modal #modal>
    <modal-header [show-close]="true">
        <h4 class="modal-title">確認メッセージ</h4>
    </modal-header>
    <modal-body>
        <section class="g-filter clearfix">
            {{ delete_fullname }}を削除します、よろしいでしょうか。
        </section>
        <section class="g-button clearfix text-center">
            <a class="btn btn-style btn-back" (click)="modal.close()"><i class="fa fa-times"></i> キャンセル</a>
            <button class="btn btn-style btn-save" type="button" (click)="onConfirmDelete()"><i class="fa fa-trash"></i> 削除</button>
        </section>
    </modal-body>
</modal>

<modal #modal_export [backdrop]="'static'">
    <modal-header [show-close]="true">
        <h4 class="modal-title">一覧出力期間指定</h4>
    </modal-header>
    <modal-body>
    	<form #formExport="ngForm">
	        <section class="g-filter clearfix">
	            <div class="g-row clearfix">
			        <div class="field clearfix w100">
			            <label for="">指定期間 <span class="note">*</span></label>
		                <div class="clearfix">
		                    <div class="input-group">
		                        <input type="text" name="export_date" class="form-control daterange-single"
		                        [ngModel]="export_date | formatdate"
	                            (ngModelChange)="export_date = $event"
	                            #export_date_input
	                            (blur)="export_date = export_date_input.value"
	                            required>
		                        <span class="input-group-addon"><i class="icon-calendar"></i></span>
		                        <span *ngIf="export_date?.dirty && export_date?.errors?.required" class="error">{{ 'VALIDATE.required' | translate }}</span>
		                    </div>
		                </div>
			        </div>
	            </div>
	        </section>
	        <section class="g-button clearfix text-center">
	            <button class="btn btn-style btn-save" type="button" [disabled]="!formExport.valid"  (click)="onExportUser(formExport)"><i class="fa fa-file-excel-o"></i> 一覧出力</button>
	            <a class="btn btn-style btn-back" (click)="modal_export.close()" ><i class="fa fa-arrow-left"></i> 戻る</a>
	        </section>
	    </form>
    </modal-body>
</modal>